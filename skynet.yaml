name: go-unit
image: golang:1.12
contact: Nate Woods (nate.woods@workiva.com)
description: Run go unit tests and report to /dev/null
run:
  source: smithy
  on-promotion: true
  on-pull-request: true
  when-branch-name-is: master
env:
  - CODECOV_TOKEN=bQ4MgjJ0G2Y73v8JNX6L7yMK9679nbYB
  - SOURCE=/go/src/github.com/Workiva/platform
  - GO111MODULE=on
scripts:
  - go get github.com/tebeka/go2xunit
  - rm -rf ${SOURCE}
  - mkdir -p ${SOURCE}
  - cp -r ./ ${SOURCE}
  - cd ${SOURCE}
  - mkdir -p out
  - go fmt ./...
  - go test -v ./... -coverprofile=out/cover.cov | tee out/go.log
  - go2xunit -input=out/go.log -output=out/go-xunit.xml
artifacts:
  - /go/src/github.com/Workiva/platform/out
test-reports:
  - /go/src/github.com/Workiva/platform/out
size: small
timeout: moderate
---
name: build-integration
image: drydock.workiva.net/workiva/skynet-images:docker_runner-latest
contact: Nate Woods (nate.woods@workiva.com)
description: Run builder and ensure results are as expected!
requires:
  Workiva/platform: docker
scripts:
  - cd test/package && ./run
size: small
timeout: moderate
