#! /bin/sh

set -e # fail on error
set -x # be verbose

# Inject the proper image into the Dockerfile for building
IMAGE="${SKYNET_APPLICATION_PLATFORM:-drydock-prod.workiva.net/workiva/platform:v0.0.4}"
echo $IMAGE
sed "s~IMAGE~${IMAGE}~g" Dockerfile.orig > Dockerfile
cat Dockerfile

# Simulate Workiva-Build (contains checks against expected values)
docker build . | tee output.log

# Verify we properly detect first exposed port as the probe port
grep -q "Using 2222 for readiness probe" output.log
